<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.burger.store.model.StoreDAO">

	<insert id="store_reigster" parameterType="com.burger.store.model.StoreDTO">

		insert into king_store values(
			#{store_key}, #{store_name}, #{store_addr}, #{store_contact},
		    #{delivery}, #{kingorder}, #{allday}, #{morning}, #{parking}, #{drivethru},
		    #{open_time}, #{delivery_time}, #{kingorder_time}, #{pi_x}, #{pi_y})
	
	</insert>
	
	<select id="near_store" parameterType="com.burger.store.model.SearchDTO"
								resultType="com.burger.store.model.StoreDTO">
		<![CDATA[
			select * from (
				select s.*, DISTANCE_WGS84(#{pi_x}, #{pi_y}, pi_x, pi_y) as DISTANCE
				from king_store s
				where (pi_x between #{pi_x}-0.019 and #{pi_x}+0.019)
				  and (pi_y between #{pi_y}-0.022 and #{pi_y}+0.022)
				order by DISTANCE)
		]]>
	</select>
	
	<select id="store_detail" resultType="com.burger.store.model.StoreDTO">
		select * from king_store where store_key = #{store_key}
	</select>
	
	<select id="store_name_search" parameterType="com.burger.store.model.SearchDTO"
								resultType="com.burger.store.model.StoreDTO">
		<![CDATA[
			select * from king_store where store_name like '%'||#{store_name}||'%'
		]]>
	</select>
	
</mapper>